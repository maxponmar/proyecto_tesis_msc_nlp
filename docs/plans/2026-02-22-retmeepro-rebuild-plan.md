# RetmeePro Rebuild Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Rebuild the RetmeePro NLP platform on Next.js 15 + Supabase + shadcn/ui, deployed to Vercel with Docusaurus docs.

**Architecture:** Next.js App Router with Server Components. Route groups split auth pages from protected dashboard pages. Supabase handles auth (cookie-based SSR sessions) and PostgreSQL database. Next.js API routes proxy requests to existing Python NLP services (FreeLing + BERT).

**Tech Stack:** Next.js 15, TypeScript, Tailwind CSS v4, shadcn/ui, Supabase (@supabase/ssr), Tiptap 2.x, Docusaurus 3.x, pnpm

**Design doc:** `docs/plans/2026-02-22-retmeepro-rebuild-design.md`

---

## Task 1: Scaffold Next.js project

**Files:**
- Create: `package.json`, `next.config.ts`, `tsconfig.json`, `src/app/layout.tsx`, `src/app/page.tsx`, `src/app/globals.css`, etc. (generated by create-next-app)

**Step 1: Create Next.js app in a temp directory and move files**

Since we already have files in the repo root (CLAUDE.md, oldversion/, docs/), we need to scaffold in a temp dir and move:

```bash
cd /tmp
pnpm create next-app@latest retmeepro-new --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --yes
```

**Step 2: Move generated files into the repo root**

```bash
# From repo root
cp -r /tmp/retmeepro-new/src ./
cp -r /tmp/retmeepro-new/public ./
cp /tmp/retmeepro-new/package.json ./
cp /tmp/retmeepro-new/tsconfig.json ./
cp /tmp/retmeepro-new/next.config.ts ./
cp /tmp/retmeepro-new/postcss.config.mjs ./
cp /tmp/retmeepro-new/.eslintrc.json ./eslintrc.json 2>/dev/null || true
cp /tmp/retmeepro-new/next-env.d.ts ./ 2>/dev/null || true
rm -rf /tmp/retmeepro-new
```

**Step 3: Install dependencies**

```bash
pnpm install
```

**Step 4: Verify the dev server starts**

```bash
pnpm dev
```

Expected: Next.js dev server starts on http://localhost:3000, shows the default Next.js page.

**Step 5: Update .gitignore for Next.js**

Add to the existing `.gitignore`:
```
# Next.js
.next/
out/

# Docusaurus
docs/build/
docs/.docusaurus/
docs/node_modules/
```

**Step 6: Commit**

```bash
git add -A
git commit -m "feat: scaffold Next.js 15 project with TypeScript and Tailwind v4"
```

---

## Task 2: Install and configure shadcn/ui

**Files:**
- Create: `components.json`, `src/lib/utils.ts`, `src/components/ui/` (generated by shadcn init)
- Modify: `src/app/globals.css`

**Step 1: Initialize shadcn/ui**

```bash
pnpm dlx shadcn@latest init
```

When prompted:
- Style: **New York**
- Base color: **Neutral**
- CSS variables: **Yes**

**Step 2: Add initial components**

```bash
pnpm dlx shadcn@latest add button card input label separator avatar dropdown-menu sheet sidebar tooltip badge table tabs textarea slider form sonner
```

**Step 3: Verify a component works**

Edit `src/app/page.tsx` to import and render a Button:

```tsx
import { Button } from "@/components/ui/button"

export default function Home() {
  return (
    <main className="flex min-h-screen items-center justify-center">
      <Button>RetmeePro</Button>
    </main>
  )
}
```

Run `pnpm dev` and verify the button renders.

**Step 4: Commit**

```bash
git add -A
git commit -m "feat: add shadcn/ui with initial component set"
```

---

## Task 3: Set up Supabase client utilities

**Files:**
- Create: `src/lib/supabase/client.ts`
- Create: `src/lib/supabase/server.ts`
- Create: `src/lib/supabase/middleware.ts`
- Create: `src/middleware.ts`
- Create: `.env.local` (not committed)
- Create: `.env.example`

**Step 1: Install Supabase packages**

```bash
pnpm add @supabase/supabase-js @supabase/ssr
```

**Step 2: Create `.env.example`**

```env
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
NLP_FREELING_URL=http://66.94.124.10:4000
NLP_BERT_URL=http://66.94.124.10:4000
```

**Step 3: Create `.env.local`**

```env
NEXT_PUBLIC_SUPABASE_URL=<actual-url-from-supabase-dashboard>
NEXT_PUBLIC_SUPABASE_ANON_KEY=<actual-anon-key-from-supabase-dashboard>
NLP_FREELING_URL=http://66.94.124.10:4000
NLP_BERT_URL=http://66.94.124.10:4000
```

**Step 4: Create browser client — `src/lib/supabase/client.ts`**

```typescript
import { createBrowserClient } from "@supabase/ssr";

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );
}
```

**Step 5: Create server client — `src/lib/supabase/server.ts`**

```typescript
import { createServerClient, type CookieOptions } from "@supabase/ssr";
import { cookies } from "next/headers";

export async function createClient() {
  const cookieStore = await cookies();

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(
          cookiesToSet: {
            name: string;
            value: string;
            options: CookieOptions;
          }[]
        ) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            );
          } catch {
            // Called from Server Component — middleware handles token refresh
          }
        },
      },
    }
  );
}
```

**Step 6: Create middleware helper — `src/lib/supabase/middleware.ts`**

```typescript
import { createServerClient, type CookieOptions } from "@supabase/ssr";
import { NextResponse, type NextRequest } from "next/server";

export async function updateSession(request: NextRequest) {
  let response = NextResponse.next({ request });

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll();
        },
        setAll(
          cookiesToSet: {
            name: string;
            value: string;
            options: CookieOptions;
          }[]
        ) {
          cookiesToSet.forEach(({ name, value, options }) => {
            response.cookies.set(name, value, options);
          });
        },
      },
    }
  );

  // IMPORTANT: Do NOT run code between createServerClient and getUser()
  const {
    data: { user },
  } = await supabase.auth.getUser();

  // Protect dashboard routes
  if (!user && request.nextUrl.pathname.startsWith("/editor")) {
    const url = request.nextUrl.clone();
    url.pathname = "/login";
    return NextResponse.redirect(url);
  }
  if (!user && request.nextUrl.pathname.startsWith("/objectives")) {
    const url = request.nextUrl.clone();
    url.pathname = "/login";
    return NextResponse.redirect(url);
  }
  if (!user && request.nextUrl.pathname.startsWith("/freeling")) {
    const url = request.nextUrl.clone();
    url.pathname = "/login";
    return NextResponse.redirect(url);
  }
  if (!user && request.nextUrl.pathname.startsWith("/history")) {
    const url = request.nextUrl.clone();
    url.pathname = "/login";
    return NextResponse.redirect(url);
  }
  if (!user && request.nextUrl.pathname.startsWith("/survey")) {
    const url = request.nextUrl.clone();
    url.pathname = "/login";
    return NextResponse.redirect(url);
  }

  // Redirect logged-in users away from auth pages
  if (user && (request.nextUrl.pathname === "/login" || request.nextUrl.pathname === "/register")) {
    const url = request.nextUrl.clone();
    url.pathname = "/editor";
    return NextResponse.redirect(url);
  }

  return response;
}
```

**Step 7: Create root middleware — `src/middleware.ts`**

```typescript
import { type NextRequest } from "next/server";
import { updateSession } from "@/lib/supabase/middleware";

export async function middleware(request: NextRequest) {
  return await updateSession(request);
}

export const config = {
  matcher: [
    "/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)",
  ],
};
```

**Step 8: Verify dev server still starts**

```bash
pnpm dev
```

Expected: Starts without errors (Supabase calls will fail without real keys, but the app loads).

**Step 9: Commit**

```bash
git add -A
git commit -m "feat: add Supabase SSR client utilities and auth middleware"
```

---

## Task 4: Create database migration files

**Files:**
- Create: `supabase/migrations/001_initial_schema.sql`

**Step 1: Create the migration directory**

```bash
mkdir -p supabase/migrations
```

**Step 2: Write the initial schema — `supabase/migrations/001_initial_schema.sql`**

```sql
-- Profiles table (extends auth.users)
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  full_name TEXT,
  created_at TIMESTAMPTZ DEFAULT now()
);

ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own profile"
  ON profiles FOR SELECT
  USING (auth.uid() = id);

CREATE POLICY "Users can update own profile"
  ON profiles FOR UPDATE
  USING (auth.uid() = id);

CREATE POLICY "Users can insert own profile"
  ON profiles FOR INSERT
  WITH CHECK (auth.uid() = id);

-- Auto-create profile on user signup
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.profiles (id, full_name)
  VALUES (NEW.id, NEW.raw_user_meta_data->>'full_name');
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();

-- Documents table (saved text analyses)
CREATE TABLE documents (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  analysis_results JSONB,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

ALTER TABLE documents ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own documents"
  ON documents FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own documents"
  ON documents FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own documents"
  ON documents FOR UPDATE
  USING (auth.uid() = user_id);

CREATE POLICY "Users can delete own documents"
  ON documents FOR DELETE
  USING (auth.uid() = user_id);

-- Surveys table
CREATE TABLE surveys (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title TEXT NOT NULL,
  questions JSONB NOT NULL,
  created_at TIMESTAMPTZ DEFAULT now()
);

ALTER TABLE surveys ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Authenticated users can view surveys"
  ON surveys FOR SELECT
  USING (auth.role() = 'authenticated');

-- Survey responses table
CREATE TABLE survey_responses (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  survey_id UUID REFERENCES surveys(id) ON DELETE CASCADE NOT NULL,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  responses JSONB NOT NULL,
  created_at TIMESTAMPTZ DEFAULT now()
);

ALTER TABLE survey_responses ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can insert own responses"
  ON survey_responses FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can view own responses"
  ON survey_responses FOR SELECT
  USING (auth.uid() = user_id);
```

**Step 3: Commit**

```bash
git add supabase/
git commit -m "feat: add initial database schema migration with RLS policies"
```

---

## Task 5: Create TypeScript types

**Files:**
- Create: `src/types/database.ts`
- Create: `src/types/nlp.ts`

**Step 1: Create database types — `src/types/database.ts`**

```typescript
export interface Profile {
  id: string;
  full_name: string | null;
  created_at: string;
}

export interface Document {
  id: string;
  user_id: string;
  title: string;
  content: string;
  analysis_results: AnalysisResults | null;
  created_at: string;
  updated_at: string;
}

export interface AnalysisResults {
  scores: AnalysisScore[];
  option: AnalysisOption;
}

export interface AnalysisScore {
  name: string;
  score: number;
  description: string;
}

export interface AnalysisOption {
  label: string;
  lsl: number;
  usl: number;
}

export interface Survey {
  id: string;
  title: string;
  questions: SurveyQuestion[];
  created_at: string;
}

export interface SurveyQuestion {
  id: string;
  question: string;
  type: "range" | "open";
  range?: { min: number; max: number };
}

export interface SurveyResponse {
  id: string;
  survey_id: string;
  user_id: string;
  responses: { question_id: string; answer: string | number }[];
  created_at: string;
}
```

**Step 2: Create NLP types — `src/types/nlp.ts`**

```typescript
export interface FreelingWord {
  form: string;
  lemma: string;
  tag: string;
  prob: number;
}

export interface FreelingAnalysisResponse {
  words: FreelingWord[];
  groups: WordGroup[];
  raw: string;
}

export interface WordGroup {
  type: string;
  words: string[];
}

export interface ObjectiveAnalysisResponse {
  que: string[];
  como: string[];
  paraque: string[];
  raw: string;
}

export interface LexicalMetrics {
  variety: number;    // Tlex / Nlex
  density: number;    // Tlex / N
  sophistication: number; // Nslex / Nlex
}
```

**Step 3: Commit**

```bash
git add src/types/
git commit -m "feat: add TypeScript type definitions for database and NLP"
```

---

## Task 6: Build the root layout and providers

**Files:**
- Modify: `src/app/layout.tsx`
- Modify: `src/app/globals.css` (add custom brand colors)
- Create: `src/app/not-found.tsx`

**Step 1: Update globals.css — add brand colors**

After the existing shadcn CSS variables in `:root`, add the RetmeePro custom colors:

```css
/* Add inside :root block, after existing shadcn variables */
--itn: oklch(0.55 0.2 250);
--itn-foreground: oklch(1 0 0);
```

And in the `@theme inline` block:

```css
--color-itn: var(--itn);
--color-itn-foreground: var(--itn-foreground);
```

**Step 2: Update root layout — `src/app/layout.tsx`**

```tsx
import type { Metadata } from "next";
import { Inter } from "next/font/google";
import { Toaster } from "@/components/ui/sonner";
import "./globals.css";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "RetmeePro - Mejorando el Texto",
  description: "Plataforma de análisis de texto NLP para escritura académica en español",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="es">
      <body className={inter.className}>
        {children}
        <Toaster />
      </body>
    </html>
  );
}
```

**Step 3: Create not-found page — `src/app/not-found.tsx`**

```tsx
import Link from "next/link";
import { Button } from "@/components/ui/button";

export default function NotFound() {
  return (
    <div className="flex min-h-screen flex-col items-center justify-center gap-4">
      <h1 className="text-4xl font-bold">404</h1>
      <p className="text-muted-foreground">Página no encontrada</p>
      <Button asChild>
        <Link href="/">Volver al inicio</Link>
      </Button>
    </div>
  );
}
```

**Step 4: Verify**

```bash
pnpm dev
```

Expected: App loads with Inter font, Spanish lang attribute.

**Step 5: Commit**

```bash
git add -A
git commit -m "feat: configure root layout with Spanish locale, brand colors, and toaster"
```

---

## Task 7: Create auth pages (login + register)

**Files:**
- Create: `src/app/(auth)/layout.tsx`
- Create: `src/app/(auth)/login/page.tsx`
- Create: `src/app/(auth)/register/page.tsx`
- Create: `src/lib/supabase/auth-actions.ts`

**Step 1: Create auth layout — `src/app/(auth)/layout.tsx`**

```tsx
export default function AuthLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <div className="flex min-h-screen items-center justify-center bg-muted/40">
      <div className="w-full max-w-md px-4">{children}</div>
    </div>
  );
}
```

**Step 2: Create server actions — `src/lib/supabase/auth-actions.ts`**

```typescript
"use server";

import { redirect } from "next/navigation";
import { createClient } from "@/lib/supabase/server";

export async function login(formData: FormData) {
  const supabase = await createClient();

  const { error } = await supabase.auth.signInWithPassword({
    email: formData.get("email") as string,
    password: formData.get("password") as string,
  });

  if (error) {
    return { error: error.message };
  }

  redirect("/editor");
}

export async function register(formData: FormData) {
  const supabase = await createClient();

  const fullName = formData.get("fullName") as string;
  const email = formData.get("email") as string;
  const password = formData.get("password") as string;

  const { error } = await supabase.auth.signUp({
    email,
    password,
    options: {
      data: { full_name: fullName },
    },
  });

  if (error) {
    return { error: error.message };
  }

  redirect("/editor");
}

export async function logout() {
  const supabase = await createClient();
  await supabase.auth.signOut();
  redirect("/login");
}
```

**Step 3: Create login page — `src/app/(auth)/login/page.tsx`**

```tsx
"use client";

import { useState } from "react";
import Link from "next/link";
import { login } from "@/lib/supabase/auth-actions";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";

export default function LoginPage() {
  const [error, setError] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  async function handleSubmit(formData: FormData) {
    setLoading(true);
    setError(null);
    const result = await login(formData);
    if (result?.error) {
      setError(result.error);
      setLoading(false);
    }
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="text-2xl">Iniciar Sesión</CardTitle>
        <CardDescription>
          Ingresa tu correo electrónico y contraseña
        </CardDescription>
      </CardHeader>
      <form action={handleSubmit}>
        <CardContent className="space-y-4">
          {error && (
            <p className="text-sm text-destructive">{error}</p>
          )}
          <div className="space-y-2">
            <Label htmlFor="email">Correo electrónico</Label>
            <Input id="email" name="email" type="email" required />
          </div>
          <div className="space-y-2">
            <Label htmlFor="password">Contraseña</Label>
            <Input id="password" name="password" type="password" required />
          </div>
        </CardContent>
        <CardFooter className="flex flex-col gap-4">
          <Button type="submit" className="w-full" disabled={loading}>
            {loading ? "Cargando..." : "Iniciar Sesión"}
          </Button>
          <p className="text-sm text-muted-foreground">
            ¿No tienes una cuenta?{" "}
            <Link href="/register" className="text-primary underline">
              Regístrate
            </Link>
          </p>
        </CardFooter>
      </form>
    </Card>
  );
}
```

**Step 4: Create register page — `src/app/(auth)/register/page.tsx`**

```tsx
"use client";

import { useState } from "react";
import Link from "next/link";
import { register } from "@/lib/supabase/auth-actions";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";

export default function RegisterPage() {
  const [error, setError] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  async function handleSubmit(formData: FormData) {
    const password = formData.get("password") as string;
    const confirm = formData.get("confirmPassword") as string;

    if (password !== confirm) {
      setError("Las contraseñas no coinciden");
      return;
    }
    if (password.length < 8) {
      setError("La contraseña debe tener al menos 8 caracteres");
      return;
    }

    setLoading(true);
    setError(null);
    const result = await register(formData);
    if (result?.error) {
      setError(result.error);
      setLoading(false);
    }
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="text-2xl">Crear Cuenta</CardTitle>
        <CardDescription>
          Completa los campos para registrarte
        </CardDescription>
      </CardHeader>
      <form action={handleSubmit}>
        <CardContent className="space-y-4">
          {error && (
            <p className="text-sm text-destructive">{error}</p>
          )}
          <div className="space-y-2">
            <Label htmlFor="fullName">Nombre completo</Label>
            <Input id="fullName" name="fullName" required />
          </div>
          <div className="space-y-2">
            <Label htmlFor="email">Correo electrónico</Label>
            <Input id="email" name="email" type="email" required />
          </div>
          <div className="space-y-2">
            <Label htmlFor="password">Contraseña</Label>
            <Input id="password" name="password" type="password" required />
          </div>
          <div className="space-y-2">
            <Label htmlFor="confirmPassword">Confirmar contraseña</Label>
            <Input id="confirmPassword" name="confirmPassword" type="password" required />
          </div>
        </CardContent>
        <CardFooter className="flex flex-col gap-4">
          <Button type="submit" className="w-full" disabled={loading}>
            {loading ? "Cargando..." : "Registrarse"}
          </Button>
          <p className="text-sm text-muted-foreground">
            ¿Ya tienes una cuenta?{" "}
            <Link href="/login" className="text-primary underline">
              Inicia Sesión
            </Link>
          </p>
        </CardFooter>
      </form>
    </Card>
  );
}
```

**Step 5: Verify pages render**

```bash
pnpm dev
# Visit http://localhost:3000/login and /register
```

**Step 6: Commit**

```bash
git add -A
git commit -m "feat: add auth pages (login, register) with Supabase server actions"
```

---

## Task 8: Create dashboard layout with sidebar and header

**Files:**
- Create: `src/app/(dashboard)/layout.tsx`
- Create: `src/components/layout/app-sidebar.tsx`
- Create: `src/components/layout/header.tsx`

**Step 1: Create header component — `src/components/layout/header.tsx`**

```tsx
import { createClient } from "@/lib/supabase/server";
import { logout } from "@/lib/supabase/auth-actions";
import { Button } from "@/components/ui/button";
import { SidebarTrigger } from "@/components/ui/sidebar";

export async function Header() {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  return (
    <header className="flex h-14 items-center gap-4 border-b bg-background px-4">
      <SidebarTrigger />
      <h1 className="text-lg font-semibold">RetmeePro</h1>
      <span className="text-sm text-muted-foreground">Mejorando el Texto</span>
      <div className="ml-auto flex items-center gap-2">
        <span className="text-sm text-muted-foreground">{user?.email}</span>
        <form action={logout}>
          <Button variant="ghost" size="sm" type="submit">
            Cerrar Sesión
          </Button>
        </form>
      </div>
    </header>
  );
}
```

**Step 2: Create sidebar component — `src/components/layout/app-sidebar.tsx`**

```tsx
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import {
  Sidebar,
  SidebarContent,
  SidebarGroup,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
} from "@/components/ui/sidebar";
import { FileText, Target, Languages, Clock, ClipboardList } from "lucide-react";

const menuItems = [
  { title: "Editor", href: "/editor", icon: FileText },
  { title: "Objetivos", href: "/objectives", icon: Target },
  { title: "FreeLing", href: "/freeling", icon: Languages },
  { title: "Historial", href: "/history", icon: Clock },
  { title: "Encuesta", href: "/survey", icon: ClipboardList },
];

export function AppSidebar() {
  const pathname = usePathname();

  return (
    <Sidebar>
      <SidebarContent>
        <SidebarGroup>
          <SidebarGroupLabel>Análisis</SidebarGroupLabel>
          <SidebarGroupContent>
            <SidebarMenu>
              {menuItems.map((item) => (
                <SidebarMenuItem key={item.href}>
                  <SidebarMenuButton asChild isActive={pathname === item.href}>
                    <Link href={item.href}>
                      <item.icon />
                      <span>{item.title}</span>
                    </Link>
                  </SidebarMenuButton>
                </SidebarMenuItem>
              ))}
            </SidebarMenu>
          </SidebarGroupContent>
        </SidebarGroup>
      </SidebarContent>
    </Sidebar>
  );
}
```

**Step 3: Create dashboard layout — `src/app/(dashboard)/layout.tsx`**

```tsx
import { SidebarProvider, SidebarInset } from "@/components/ui/sidebar";
import { AppSidebar } from "@/components/layout/app-sidebar";
import { Header } from "@/components/layout/header";

export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <SidebarProvider>
      <AppSidebar />
      <SidebarInset>
        <Header />
        <main className="flex-1 overflow-auto p-6">{children}</main>
      </SidebarInset>
    </SidebarProvider>
  );
}
```

**Step 4: Create placeholder pages for each dashboard route**

Create simple placeholder pages for each route:

- `src/app/(dashboard)/editor/page.tsx`
- `src/app/(dashboard)/objectives/page.tsx`
- `src/app/(dashboard)/freeling/page.tsx`
- `src/app/(dashboard)/history/page.tsx`
- `src/app/(dashboard)/survey/page.tsx`

Each one as:

```tsx
export default function EditorPage() {
  return (
    <div>
      <h2 className="text-2xl font-bold">Editor de Riqueza Léxica</h2>
      <p className="text-muted-foreground">En construcción...</p>
    </div>
  );
}
```

(Change the title/content for each page accordingly)

**Step 5: Verify sidebar navigation works**

```bash
pnpm dev
# Visit /editor, click sidebar links, verify layout + navigation
```

**Step 6: Commit**

```bash
git add -A
git commit -m "feat: add dashboard layout with sidebar navigation and header"
```

---

## Task 9: Create NLP API proxy routes

**Files:**
- Create: `src/app/api/nlp/analyze/route.ts`
- Create: `src/app/api/nlp/objective/route.ts`
- Create: `src/app/api/nlp/health/route.ts`

**Step 1: Create FreeLing analyze proxy — `src/app/api/nlp/analyze/route.ts`**

```typescript
import { NextRequest, NextResponse } from "next/server";
import { createClient } from "@/lib/supabase/server";

export async function POST(request: NextRequest) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    return NextResponse.json({ error: "No autorizado" }, { status: 401 });
  }

  const body = await request.json();

  const response = await fetch(`${process.env.NLP_FREELING_URL}/api/freeling`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body),
  });

  const data = await response.json();
  return NextResponse.json(data);
}
```

**Step 2: Create BERT objective proxy — `src/app/api/nlp/objective/route.ts`**

```typescript
import { NextRequest, NextResponse } from "next/server";
import { createClient } from "@/lib/supabase/server";

export const maxDuration = 60; // Vercel free tier max

export async function POST(request: NextRequest) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    return NextResponse.json({ error: "No autorizado" }, { status: 401 });
  }

  const body = await request.json();

  const response = await fetch(`${process.env.NLP_BERT_URL}/analyze_objective/`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body),
    signal: AbortSignal.timeout(55000), // 55s to leave margin for Vercel
  });

  const data = await response.json();
  return NextResponse.json(data);
}
```

**Step 3: Create health check — `src/app/api/nlp/health/route.ts`**

```typescript
import { NextResponse } from "next/server";

export async function GET() {
  try {
    const response = await fetch(`${process.env.NLP_FREELING_URL}/api/freeling`, {
      method: "GET",
      signal: AbortSignal.timeout(5000),
    });

    return NextResponse.json({
      status: response.ok ? "healthy" : "unhealthy",
      freeling: response.ok,
    });
  } catch {
    return NextResponse.json({
      status: "unhealthy",
      freeling: false,
    });
  }
}
```

**Step 4: Commit**

```bash
git add src/app/api/
git commit -m "feat: add NLP API proxy routes for FreeLing and BERT"
```

---

## Task 10: Create the home/landing page

**Files:**
- Modify: `src/app/page.tsx`

**Step 1: Build the landing page — `src/app/page.tsx`**

```tsx
import Link from "next/link";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { createClient } from "@/lib/supabase/server";

export default async function HomePage() {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  return (
    <div className="flex min-h-screen flex-col">
      <header className="flex h-14 items-center border-b px-6">
        <span className="text-lg font-bold">RetmeePro</span>
        <nav className="ml-auto flex gap-2">
          {user ? (
            <Button asChild>
              <Link href="/editor">Ir al Editor</Link>
            </Button>
          ) : (
            <>
              <Button variant="ghost" asChild>
                <Link href="/login">Iniciar Sesión</Link>
              </Button>
              <Button asChild>
                <Link href="/register">Registrarse</Link>
              </Button>
            </>
          )}
        </nav>
      </header>

      <main className="flex flex-1 flex-col items-center justify-center gap-8 px-6 py-12">
        <div className="text-center">
          <h1 className="text-4xl font-bold tracking-tight sm:text-5xl">
            RetmeePro
          </h1>
          <p className="mt-4 text-xl text-muted-foreground">
            Mejorando el Texto — Plataforma de análisis NLP para escritura académica
          </p>
        </div>

        <div className="grid w-full max-w-4xl gap-6 sm:grid-cols-3">
          <Card>
            <CardHeader>
              <CardTitle>Riqueza Léxica</CardTitle>
              <CardDescription>
                Analiza variedad, densidad y sofisticación de tu texto
              </CardDescription>
            </CardHeader>
          </Card>
          <Card>
            <CardHeader>
              <CardTitle>Objetivos Académicos</CardTitle>
              <CardDescription>
                Descompone objetivos en Qué, Cómo y Para Qué
              </CardDescription>
            </CardHeader>
          </Card>
          <Card>
            <CardHeader>
              <CardTitle>Análisis Lingüístico</CardTitle>
              <CardDescription>
                Etiquetado POS, lematización y análisis morfológico con FreeLing
              </CardDescription>
            </CardHeader>
          </Card>
        </div>

        <Button size="lg" asChild>
          <Link href={user ? "/editor" : "/register"}>
            Comenzar Ahora
          </Link>
        </Button>
      </main>

      <footer className="border-t py-6 text-center text-sm text-muted-foreground">
        RetmeePro — Maximiliano Ponce Márquez
      </footer>
    </div>
  );
}
```

**Step 2: Verify**

```bash
pnpm dev
# Visit http://localhost:3000
```

**Step 3: Commit**

```bash
git add src/app/page.tsx
git commit -m "feat: add landing page with feature cards and auth-aware navigation"
```

---

## Task 11: Scaffold Docusaurus docs site

**Files:**
- Create: `docs/` directory (Docusaurus scaffolding)

**Step 1: Create Docusaurus project**

```bash
cd /Users/maximiliano/Repositories/Freelance/retmeepro
pnpm create docusaurus docs classic --typescript
```

**Step 2: Change default port to avoid conflict with Next.js**

Edit `docs/package.json` — change the `start` script:

```json
"start": "docusaurus start --port 3001"
```

**Step 3: Update `docs/docusaurus.config.ts`**

Update the title, tagline, and URL:

```typescript
const config: Config = {
  title: "RetmeePro Docs",
  tagline: "Documentación técnica de la plataforma RetmeePro",
  url: "https://retmeepro-docs.vercel.app",
  baseUrl: "/",
  organizationName: "maxponmar",
  projectName: "retmeepro",
  // ... rest of config
};
```

**Step 4: Create initial documentation structure**

Replace `docs/docs/intro.md`:

```markdown
---
sidebar_position: 1
---

# Introducción

RetmeePro es una plataforma de análisis de procesamiento de lenguaje natural (NLP) diseñada para mejorar la escritura académica en español.

## Características

- **Riqueza Léxica:** Análisis de variedad, densidad y sofisticación del texto
- **Objetivos Académicos:** Descomposición de objetivos usando modelo BERT
- **Análisis FreeLing:** Etiquetado POS, lematización y análisis morfológico
- **Historial:** Guardado y revisión de documentos analizados
- **Encuestas:** Recolección de retroalimentación de usuarios

## Stack Tecnológico

| Capa | Tecnología |
|------|-----------|
| Framework | Next.js 15 |
| Lenguaje | TypeScript |
| Estilos | Tailwind CSS v4 + shadcn/ui |
| Auth + BD | Supabase |
| NLP | FreeLing + BERT |
| Despliegue | Vercel |
```

**Step 5: Verify Docusaurus runs**

```bash
cd docs && pnpm install && pnpm start
```

Expected: Docusaurus dev server on http://localhost:3001

**Step 6: Update root .gitignore**

Add:
```
docs/build/
docs/.docusaurus/
docs/node_modules/
```

**Step 7: Commit**

```bash
cd /Users/maximiliano/Repositories/Freelance/retmeepro
git add docs/ .gitignore
git commit -m "feat: scaffold Docusaurus documentation site"
```

---

## Task 12: Update CLAUDE.md for new architecture

**Files:**
- Modify: `CLAUDE.md`

**Step 1: Rewrite CLAUDE.md to reflect the new project structure**

Update CLAUDE.md with:
- New project structure (Next.js App Router + Supabase)
- New commands (`pnpm dev`, `pnpm build`, etc.)
- New architecture description
- Supabase configuration details
- NLP proxy route descriptions
- Docusaurus commands

**Step 2: Commit**

```bash
git add CLAUDE.md
git commit -m "docs: update CLAUDE.md for new Next.js + Supabase architecture"
```

---

## Task 13: Configure Vercel deployment

**Files:**
- Create: `vercel.json`

**Step 1: Create Vercel config — `vercel.json`**

```json
{
  "framework": "nextjs",
  "buildCommand": "pnpm build",
  "installCommand": "pnpm install",
  "functions": {
    "src/app/api/nlp/objective/route.ts": {
      "maxDuration": 60
    }
  }
}
```

**Step 2: Commit**

```bash
git add vercel.json
git commit -m "feat: add Vercel deployment configuration"
```

---

## Task 14: Final verification and push

**Step 1: Run build to verify no TypeScript errors**

```bash
pnpm build
```

Expected: Build succeeds with no errors.

**Step 2: Run lint**

```bash
pnpm lint
```

Fix any lint errors.

**Step 3: Push all commits**

```bash
git push origin master
```

---

## Summary of commits

1. `feat: scaffold Next.js 15 project with TypeScript and Tailwind v4`
2. `feat: add shadcn/ui with initial component set`
3. `feat: add Supabase SSR client utilities and auth middleware`
4. `feat: add initial database schema migration with RLS policies`
5. `feat: add TypeScript type definitions for database and NLP`
6. `feat: configure root layout with Spanish locale, brand colors, and toaster`
7. `feat: add auth pages (login, register) with Supabase server actions`
8. `feat: add dashboard layout with sidebar navigation and header`
9. `feat: add NLP API proxy routes for FreeLing and BERT`
10. `feat: add landing page with feature cards and auth-aware navigation`
11. `feat: scaffold Docusaurus documentation site`
12. `docs: update CLAUDE.md for new Next.js + Supabase architecture`
13. `feat: add Vercel deployment configuration`

---

## What comes next (future tasks, not in this plan)

- Implement the actual Editor page (Tiptap + lexical analysis logic)
- Implement the Objectives page (BERT integration)
- Implement the FreeLing analysis page
- Implement the History page (Supabase queries + data table)
- Implement the Survey page
- Add About, Support, Terms pages
- Set up Supabase project and run migrations
- Deploy to Vercel
- Write comprehensive Docusaurus documentation
